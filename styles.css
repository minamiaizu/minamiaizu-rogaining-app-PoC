*{margin:0;padding:0;box-sizing:border-box}
:root{
  --primary:#667eea;
  --primary-dark:#5568d3;
  --success:#48bb78;
  --danger:#e53e3e;
  --text:#2d3748;
  --muted:#718096;
  --card:#fff;
  --bg:#f5f5f5;
}
html,body{height:100%}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,system-ui,sans-serif;background:var(--bg);color:var(--text)}
main{padding-bottom:40px}
.card{background:var(--card);margin:15px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);padding:20px}

#header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:12px 16px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
#header .app-title{display:flex;gap:8px;align-items:center}
.title-icon{border-radius:6px}
#header h1{font-size:18px}

#tabs{display:flex;gap:8px;margin-top:8px}
.tab{flex:1;padding:8px 10px;text-align:center;background:rgba(255,255,255,.2);border:none;border-radius:8px;cursor:pointer;font-size:14px;color:#fff;transition:.2s}
.tab:hover{background:rgba(255,255,255,.3)}
.tab.active{background:#fff;color:var(--primary);font-weight:700}

#status{display:flex;justify-content:space-between;font-size:14px;opacity:.95;margin-top:6px}

#map{width:100%;height:400px}

.button{width:100%;padding:14px;margin:10px 0;border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;transition:.2s}
.button-primary{background:var(--primary);color:#fff}
.button-primary:hover{background:var(--primary-dark);transform:translateY(-1px);box-shadow:0 4px 12px rgba(102,126,234,.4)}
.button-success{background:var(--success);color:#fff}
.button.danger{background:var(--danger);color:#fff}
.button.track{background:var(--success);color:#fff}
.button:disabled{background:#cbd5e0;cursor:not-allowed;transform:none}

#info h3,#checkpoint-list h3,#photo-gallery h3{margin-bottom:10px}

.info-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #e2e8f0}
.info-item:last-child{border-bottom:none}
.info-label{font-weight:700;color:#4a5568}
.info-value{color:var(--primary);font-weight:700}

#checkpoints .checkpoint-item{padding:12px;margin:8px 0;border-radius:10px;background:#f7fafc;display:flex;justify-content:space-between;align-items:center}
#checkpoints .checkpoint-item.completed{background:#c6f6d5}
#checkpoints .checkpoint-item.near{background:#fed7d7;animation:pulse 2s infinite}
.checkpoint-name{font-weight:700}
.checkpoint-points{background:var(--primary);color:#fff;padding:4px 12px;border-radius:20px;font-size:14px;font-weight:700}
.checkpoint-item.completed .checkpoint-points{background:var(--success)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.75}}

#debug{background:#2d3748;color:#e2e8f0;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;max-height:220px;overflow:auto}
.debug-line{padding:2px 0}

.photo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px;margin-top:10px}
.photo-thumbnail{position:relative;aspect-ratio:1;border-radius:10px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.1);cursor:pointer;transition:transform .2s}
.photo-thumbnail:hover{transform:scale(1.03)}
.photo-thumbnail img{width:100%;height:100%;object-fit:cover}
.photo-info{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.65);color:#fff;padding:4px 8px;font-size:11px}

.photo-modal{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:9999;display:flex;justify-content:center;align-items:center}
.photo-modal[hidden]{display:none}
.photo-modal img{max-width:90%;max-height:90%;border-radius:8px}
.photo-modal-close{position:absolute;top:20px;right:20px;color:#fff;background:transparent;border:none;font-size:36px;cursor:pointer}

#install-banner{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:14px 18px;z-index:9999;box-shadow:0 -2px 10px rgba(0,0,0,.2);animation:slideUp .3s ease-out}
#install-banner[hidden]{display:none}
#install-banner-content{display:flex;justify-content:space-between;align-items:center;gap:12px}
.banner-actions{display:flex;gap:10px}
#install-banner button{background:#fff;color:var(--primary);border:none;padding:8px 16px;border-radius:8px;font-weight:700;cursor:pointer}
#install-banner .close-btn{background:transparent;color:#fff;font-size:20px}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}

@keyframes fadeIn{from{opacity:0}to{opacity:1}}

#compass-view{position:relative;overflow:hidden;width:100%;height:calc(100vh - 220px);min-height:400px;background:linear-gradient(180deg,#87CEEB 0%,#E0F6FF 100%);margin-top:10px}
#compass-container{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:min(85vw,85vh,420px);height:min(85vw,85vh,420px)}
#compass-circle{position:absolute;width:100%;height:100%;border-radius:50%;background:radial-gradient(circle at center,#fff 0%,#f7fafc 70%,#e2e8f0 100%);box-shadow:0 0 0 3px #2d3748,0 0 0 6px #e2e8f0,0 8px 30px rgba(0,0,0,.3),inset 0 2px 10px rgba(255,255,255,.8),inset 0 -2px 10px rgba(0,0,0,.1);will-change:transform}
#compass-center{position:absolute;top:50%;left:50%;width:30px;height:30px;margin:-15px 0 0 -15px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#ffd700 0%,#b8860b 100%);box-shadow:0 2px 8px rgba(0,0,0,.3),inset 0 1px 3px rgba(255,255,255,.5);z-index:10}
#compass-center::after{content:"";position:absolute;top:50%;left:50%;width:8px;height:8px;margin:-4px 0 0 -4px;border-radius:50%;background:#2d3748;box-shadow:inset 0 1px 2px rgba(0,0,0,.5)}
.compass-direction{position:absolute;font-weight:800;font-size:22px;color:#2d3748;text-shadow:0 1px 2px rgba(255,255,255,.8);font-family:Georgia,serif}
.compass-direction.north{top:8px;left:50%;transform:translateX(-50%);color:#c53030;font-size:32px;text-shadow:0 2px 4px rgba(197,48,48,.3),0 1px 2px rgba(255,255,255,.8)}
.compass-direction.east{top:50%;right:8px;transform:translateY(-50%)}
.compass-direction.south{bottom:8px;left:50%;transform:translateX(-50%)}
.compass-direction.west{top:50%;left:8px;transform:translateY(-50%)}
.compass-subdirection{position:absolute;font-weight:700;font-size:14px;color:#4a5568;text-shadow:0 1px 2px rgba(255,255,255,.8);font-family:Georgia,serif}

#compass-needle{position:absolute;top:50%;left:50%;width:8px;height:160px;margin:-80px 0 0 -4px;transform-origin:center center;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3));z-index:5}
.needle-north{position:absolute;top:0;left:0;width:100%;height:50%;background:#2d3748;clip-path:polygon(50% 0%,20% 95%,50% 100%,80% 95%)}
.needle-south{position:absolute;bottom:0;left:0;width:100%;height:50%;background:#2d3748;clip-path:polygon(20% 5%,50% 0%,80% 5%,50% 100%)}

#heading-display{position:absolute;top:60px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,.9);padding:8px 16px;border-radius:20px;font-size:18px;font-weight:800;color:#2d3748;box-shadow:0 2px 10px rgba(0,0,0,.1);z-index:100;pointer-events:none}

#checkpoint-markers{position:absolute;inset:0;pointer-events:none}
.checkpoint-marker{position:absolute;width:36px;height:36px;margin-left:-18px;margin-top:-18px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.3);transition:transform .2s;pointer-events:auto}
.checkpoint-marker.completed{background:var(--success)}

#distance-bar-container{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);width:90%;max-width:640px;z-index:100}
#distance-bar-label{display:flex;justify-content:space-between;font-size:12px;color:#2d3748;margin-bottom:6px;font-weight:800}
#distance-bar{position:relative;height:40px;border-radius:20px;background:linear-gradient(to right,hsl(240,80%,50%) 0%,hsl(180,80%,50%) 25%,hsl(120,80%,50%) 50%,hsl(60,80%,50%) 75%,hsl(0,80%,50%) 100%);box-shadow:0 2px 10px rgba(0,0,0,.2);overflow:visible}
.distance-marker{position:absolute;width:32px;height:32px;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.3);top:50%;transform:translate(-50%,-50%);cursor:pointer;transition:transform .2s}
.distance-marker.completed{background:var(--success)!important}

.custom-tooltip{position:fixed;background:rgba(45,55,72,.95);color:#fff;padding:8px 12px;border-radius:8px;font-size:14px;font-weight:800;z-index:10001;pointer-events:none;box-shadow:0 4px 12px rgba(0,0,0,.3);white-space:nowrap;transform:translate(-50%,-100%);margin-top:-10px}
.custom-tooltip::after{content:"";position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid rgba(45,55,72,.95)}

/* Sonar view */
#sonar-view{position:relative;overflow:hidden;background:linear-gradient(180deg,#f0f4f8 0%,#ffffff 100%);min-height:100vh;padding-bottom:20px}

.sonar-range-controls{display:flex;gap:8px;padding:15px;justify-content:center;flex-wrap:wrap}

#sonar-container{position:relative;width:min(85vw,85vh,450px);height:min(85vw,85vh,450px);margin:20px auto;background:#ffffff;border-radius:50%;box-shadow:0 4px 20px rgba(0,0,0,0.15),inset 0 2px 10px rgba(0,0,0,0.05)}

#sonar-canvas{width:100%;height:100%;border-radius:50%;box-shadow:inset 0 0 0 8px #e8e8e8,inset 0 0 50px rgba(0,0,0,0.08)}

.sonar-cardinal{position:absolute;font-weight:800;font-size:24px;color:#2d3748;text-shadow:0 1px 2px rgba(255,255,255,0.8);pointer-events:none;z-index:10}

.sonar-cardinal.north{top:10px;left:50%;transform:translateX(-50%);color:#e53e3e;font-size:32px;text-shadow:0 1px 3px rgba(255,255,255,0.9)}

.sonar-cardinal.east{top:50%;right:10px;transform:translateY(-50%)}

.sonar-cardinal.south{bottom:10px;left:50%;transform:translateX(-50%)}

.sonar-cardinal.west{top:50%;left:10px;transform:translateY(-50%)}

#elevation-distance-bar{margin:20px 15px;background:rgba(255,255,255,0.9);border-radius:12px;padding:15px;box-shadow:0 2px 8px rgba(0,0,0,0.1);border:1px solid #e2e8f0}

.bar-header{display:flex;justify-content:space-between;color:#2d3748;font-size:13px;font-weight:700;margin-bottom:10px}

.distance-track{position:relative;height:40px;margin-bottom:5px}

#distance-gradient-canvas{width:100%;height:100%;border-radius:20px}

#distance-markers-container{position:absolute;inset:0;pointer-events:none}

.elevation-profile{position:relative;height:120px;margin-top:10px;background:#f7fafc;border-radius:8px;border:1px solid #e2e8f0}

#elevation-profile-canvas{width:100%;height:100%;border-radius:8px}

.current-position-marker{position:absolute;left:40px;bottom:-5px;transform:translateX(0);font-size:24px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));pointer-events:none;z-index:10}

#sonar-nearest-info{background:rgba(255,255,255,0.95);margin:15px;padding:15px;border-radius:12px;color:#2d3748;box-shadow:0 2px 8px rgba(0,0,0,0.1);border:1px solid #e2e8f0}

.info-name{font-size:13px;font-weight:700;margin-bottom:10px;color:#4a5568;text-transform:uppercase;letter-spacing:0.5px}

.info-details{font-size:16px;color:#2d3748;display:flex;gap:15px;flex-wrap:wrap;font-weight:700}

.sonar-audio-toggle{text-align:center;padding:15px}

.sonar-audio-toggle label{color:#2d3748;font-size:14px;display:inline-flex;align-items:center;gap:8px;cursor:pointer;user-select:none;font-weight:600}

.sonar-audio-toggle input[type="checkbox"]{width:20px;height:20px;cursor:pointer}

/* AR view */
#ar-view{position:relative;min-height:420px;overflow:hidden;border-radius:12px;margin:15px}
#camera{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:1}
#ar-canvas{position:absolute;inset:0;width:100%;height:100%;z-index:10;pointer-events:none}
.ar-overlay{position:absolute;inset:0;pointer-events:none;z-index:100}
.ar-top-strip{position:absolute;top:0;left:0;right:0;height:50px;z-index:101;overflow:hidden;pointer-events:none}

/* 色の凡例 */
#ar-legend{position:absolute;top:60px;right:10px;background:rgba(0,0,0,.6);padding:8px 12px;border-radius:8px;backdrop-filter:blur(4px);pointer-events:none;min-width:120px}
.legend-title{color:#fff;font-size:11px;font-weight:700;margin-bottom:4px;text-align:center}
.legend-gradient{height:20px;border-radius:4px;background:linear-gradient(to right,hsl(240,80%,50%) 0%,hsl(180,80%,50%) 25%,hsl(120,80%,50%) 50%,hsl(60,80%,50%) 75%,hsl(0,80%,50%) 100%);border:1px solid rgba(255,255,255,.3)}
.legend-labels{display:flex;justify-content:space-between;color:#fff;font-size:10px;font-weight:700;margin-top:2px}

/* ピッチインジケーター */
.pitch-indicator{position:absolute;top:50%;transform:translateY(-50%);width:60px;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);border-radius:8px;padding:10px 0;pointer-events:none}
#pitch-indicator-left{left:10px}
#pitch-indicator-right{right:10px}
.pitch-scale{position:relative}
.pitch-line{position:relative;height:20px;display:flex;align-items:center;border-left:2px solid rgba(255,255,255,.4);margin:5px 0}
#pitch-indicator-left .pitch-line{justify-content:flex-end;padding-right:8px}
#pitch-indicator-right .pitch-line{justify-content:flex-start;padding-left:8px;border-left:none;border-right:2px solid rgba(255,255,255,.4)}
.pitch-line span{color:#fff;font-size:10px;font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,.8)}
.pitch-line.pitch-zero{border-color:#48bb78;border-width:3px}
.pitch-line.pitch-zero span{color:#48bb78;font-size:11px}
.pitch-marker-container{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none}
.pitch-marker{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#48bb78;font-size:18px;font-weight:900;text-shadow:0 2px 4px rgba(0,0,0,.8);transition:top .2s ease-out}
#pitch-indicator-left .pitch-marker{left:auto;right:-5px;transform:translate(0,-50%)}
#pitch-indicator-right .pitch-marker{left:-5px;right:auto;transform:translate(0,-50%)}

/* AR最寄りCP情報セクション (新規) */
#ar-nearest-info{background:rgba(255,255,255,0.95);margin:15px;padding:15px;border-radius:12px;color:#2d3748;box-shadow:0 2px 8px rgba(0,0,0,0.1);border:1px solid #e2e8f0}

#ar-nearest-info .info-name{font-size:13px;font-weight:700;margin-bottom:10px;color:#4a5568;text-transform:uppercase;letter-spacing:0.5px}

#ar-nearest-info .info-details{font-size:16px;color:#2d3748;display:flex;gap:15px;flex-wrap:wrap;font-weight:700}

.ar-range{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;gap:8px;align-items:center;background:rgba(0,0,0,.5);padding:10px 12px;border-radius:12px;backdrop-filter:blur(4px);z-index:101}

/* マーカー調整コントロール（新規） */
.ar-marker-controls{display:flex;gap:6px;align-items:center}

.marker-adjust-btn{
  pointer-events:auto;
  background:rgba(255,255,255,0.9);
  border:2px solid #667eea;
  border-radius:8px;
  padding:6px 10px;
  font-size:16px;
  color:#2d3748;
  cursor:pointer;
  transition:all .2s;
  line-height:1;
}

.marker-adjust-btn:hover{
  background:#667eea;
  color:#fff;
  transform:scale(1.05);
}

.marker-adjust-btn:active{
  transform:scale(0.95);
  box-shadow:0 2px 8px rgba(102,126,234,.5);
}

/* オフセットフィードバック（新規） */
.offset-feedback{
  position:absolute;
  top:60px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.7);
  color:#fff;
  padding:8px 16px;
  border-radius:20px;
  font-size:14px;
  font-weight:700;
  opacity:0;
  transition:opacity 0.3s;
  pointer-events:none;
  z-index:102;
}

.ar-fov-selector{display:flex;gap:6px}
.ar-range-selector{display:flex;gap:6px}
.fov-btn,.range-btn{pointer-events:auto;background:#fff;border:none;border-radius:8px;padding:8px 12px;font-weight:800;font-size:13px;color:var(--text);cursor:pointer;transition:all .2s}
.fov-btn:hover,.range-btn:hover{transform:scale(1.05)}
.fov-btn.active,.range-btn.active{background:var(--primary);color:#fff;box-shadow:0 2px 8px rgba(102,126,234,.5)}
.ar-countdown{color:#fff;font-weight:800;font-size:14px}

#compass-ticks{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}

/* Calibration UI (新規) */
.calibration-ui{position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:9998;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);animation:fadeIn 0.3s}
.calibration-ui[hidden]{display:none}
.calibration-content{background:#fff;padding:30px;border-radius:16px;max-width:400px;width:90%;box-shadow:0 10px 40px rgba(0,0,0,0.4);text-align:center}
.calibration-content h3{margin:0 0 15px 0;font-size:24px;color:#2d3748}
.calibration-content p{margin:0 0 20px 0;line-height:1.6;color:#4a5568}
.calibration-content .button{margin:8px 0}

/* ARデバッグボタン表示切替 (新規追加) */
.ar-debug-toggle{text-align:center;padding:15px;margin-top:10px;border-top:1px solid #e2e8f0}

.ar-debug-toggle label{color:#2d3748;font-size:14px;display:inline-flex;align-items:center;gap:8px;cursor:pointer;user-select:none;font-weight:600}

.ar-debug-toggle input[type="checkbox"]{width:20px;height:20px;cursor:pointer}
